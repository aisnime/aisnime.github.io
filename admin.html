<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halaman Admin - Manajemen Konten</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="time"]::-webkit-calendar-picker-indicator { filter: invert(1); }
        .menu-btn { border-bottom: 3px solid transparent; transition: all 0.3s ease; }
        .menu-btn.active-menu { border-bottom-color: #8B5CF6; color: white; }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div class="container mx-auto p-4 lg:p-8 max-w-4xl">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-extrabold text-white">Panel Admin (Firebase)</h1>
            <p class="text-lg text-gray-400 mt-2">Data disimpan secara online dan terpusat.</p>
        </header>

        <div class="mb-8 flex justify-center border-b border-gray-700">
            <button id="show-manage-view-btn" class="menu-btn py-4 px-6 font-semibold text-gray-400">Kelola Konten</button>
            <button id="show-add-view-btn" class="menu-btn py-4 px-6 font-semibold text-gray-400">Tambah Konten</button>
            <button id="show-settings-view-btn" class="menu-btn py-4 px-6 font-semibold text-gray-400">Setting</button>
        </div>

        <div id="views-container">
            <div id="add-content-view" class="hidden">
                <div class="bg-gray-800 p-8 rounded-lg shadow-2xl space-y-6">
                    <h2 class="text-2xl font-bold text-center">Tambah Konten Baru</h2>
                    <div><label for="title" class="block text-sm font-medium text-gray-300 mb-1">Judul Konten</label><input type="text" id="title" class="w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-white" placeholder="Contoh: Pemandangan Indah"></div>
                    <div><label for="thumbnail-url" class="block text-sm font-medium text-gray-300 mb-1">URL Thumbnail</label><input type="text" id="thumbnail-url" class="w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-white" placeholder="https://example.com/thumbnail.jpg"></div>
                    <div><label for="description" class="block text-sm font-medium text-gray-300 mb-1">Deskripsi</label><textarea id="description" rows="4" class="w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-white" placeholder="Deskripsi singkat..."></textarea></div>
                    <div class="border-t border-gray-700 pt-6 space-y-4">
                        <h3 class="text-lg font-semibold text-white">URL File Video (Wajib isi minimal satu)</h3>
                        <div><label for="video-url-1080p" class="block text-sm font-medium text-gray-300 mb-1">URL Video 1080p</label><input type="text" id="video-url-1080p" class="w-full bg-gray-700 border rounded-md p-3" placeholder="https://example.com/video_1080p.mp4"></div>
                        <div><label for="video-url-720p" class="block text-sm font-medium text-gray-300 mb-1">URL Video 720p</label><input type="text" id="video-url-720p" class="w-full bg-gray-700 border rounded-md p-3" placeholder="https://example.com/video_720p.mp4"></div>
                        <div><label for="video-url-480p" class="block text-sm font-medium text-gray-300 mb-1">URL Video 480p</label><input type="text" id="video-url-480p" class="w-full bg-gray-700 border rounded-md p-3" placeholder="https://example.com/video_480p.mp4"></div>
                    </div>
                    <div class="border-t border-gray-700 pt-6">
                        <h3 class="text-lg font-semibold text-white">Jadwalkan Publikasi</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div><label for="publish-date" class="block text-sm font-medium text-gray-300 mb-1">Tanggal</label><input type="date" id="publish-date" class="w-full bg-gray-700 rounded-md p-3"></div>
                            <div><label for="publish-time" class="block text-sm font-medium text-gray-300 mb-1">Waktu</label><input type="time" id="publish-time" class="w-full bg-gray-700 rounded-md p-3"></div>
                        </div>
                    </div>
                    <div><button id="upload-button" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-md transition">Unggah Konten</button></div>
                    <p id="status-message" class="text-center text-sm min-h-[20px]"></p>
                </div>
            </div>
            <div id="manage-content-view">
                 <div class="bg-gray-800 p-8 rounded-lg shadow-2xl">
                    <h2 class="text-2xl font-bold mb-6">Kelola Konten</h2>
                    <div id="content-list-container" class="space-y-4">
                        <p id="content-list-loading" class="text-gray-400">Memuat daftar konten...</p>
                    </div>
                </div>
            </div>
            <div id="settings-view" class="hidden">
                  <div class="bg-gray-800 p-8 rounded-lg shadow-2xl space-y-8">
                    <div class="space-y-4">
                        <h2 class="text-2xl font-bold text-center">Pengaturan Background</h2>
                        <div><label for="background-url" class="block text-sm font-medium">URL Gambar Background</label><input type="text" id="background-url" placeholder="https://example.com/background.jpg" class="w-full bg-gray-700 rounded-md p-3 mt-1"></div>
                        <div id="background-preview-container" class="hidden text-center"><span class="block mb-2">Preview:</span><img id="background-preview" class="w-full h-32 object-cover rounded-lg"></div>
                    </div>
                    <div class="border-t border-gray-700 pt-8 space-y-4">
                        <h2 class="text-2xl font-bold text-center">Pengaturan Logo Halaman Utama</h2>
                        <div><label for="main-logo-url" class="block text-sm font-medium">URL Logo Utama</label><input type="text" id="main-logo-url" placeholder="https://example.com/logo.png" class="w-full bg-gray-700 rounded-md p-3 mt-1"></div>
                        <div id="main-logo-preview-container" class="hidden text-center"><span class="block mb-2">Preview:</span><img id="main-logo-preview" class="w-auto h-20 mx-auto"></div>
                    </div>
                    <div class="border-t border-gray-700 pt-8 space-y-4">
                        <h2 class="text-2xl font-bold text-center">Pengaturan Favicon</h2>
                        <div><label for="favicon-url" class="block text-sm font-medium">URL Favicon</label><input type="text" id="favicon-url" placeholder="https://example.com/favicon.ico" class="w-full bg-gray-700 rounded-md p-3 mt-1"></div>
                        <div id="favicon-preview-container" class="hidden text-center"><span class="block mb-2">Preview:</span><img id="favicon-preview" class="w-16 h-16 rounded-full mx-auto"></div>
                    </div>
                    <div class="border-t border-gray-700 pt-8 space-y-4">
                        <h2 class="text-2xl font-bold text-center">Pengaturan Video Pembuka</h2>
                        <div><label for="intro-video-url" class="block text-sm font-medium">URL Video Pembuka</label><input type="text" id="intro-video-url" placeholder="https://example.com/intro.mp4" class="w-full bg-gray-700 rounded-md p-3 mt-1"></div>
                        <div id="intro-video-preview-container" class="hidden"><span class="mr-4">Preview:</span><video id="intro-video-preview" class="w-40 h-22 rounded-md inline-block" controls></video></div>
                    </div>
                    <div class="border-t border-gray-700 pt-8">
                         <button id="save-settings-button" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-md transition">Simpan Semua Pengaturan</button>
                         <p id="settings-status-message" class="text-center text-sm min-h-[20px] mt-4"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="update-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-50">
       <div class="bg-gray-800 rounded-lg shadow-2xl p-8 w-full max-w-2xl space-y-6 max-h-screen overflow-y-auto">
             <h2 class="text-2xl font-bold">Ubah Detail Konten</h2>
             <div><label for="update-title" class="block text-sm font-medium">Judul</label><input type="text" id="update-title" class="w-full bg-gray-700 rounded-md p-3 mt-1"></div>
             <div><label for="update-thumbnail-url" class="block text-sm font-medium">URL Thumbnail</label><input type="text" id="update-thumbnail-url" class="w-full bg-gray-700 rounded-md p-3 mt-1"></div>
             <div><label for="update-description" class="block text-sm font-medium">Deskripsi</label><textarea id="update-description" rows="4" class="w-full bg-gray-700 rounded-md p-3 mt-1"></textarea></div>
             <div class="border-t border-gray-700 pt-6 space-y-4">
                 <h3 class="text-lg font-semibold">URL Video</h3>
                 <div><label for="update-video-url-1080p" class="block text-sm font-medium">1080p</label><input type="text" id="update-video-url-1080p" class="w-full bg-gray-700 rounded-md p-3 mt-1"></div>
                 <div><label for="update-video-url-720p" class="block text-sm font-medium">720p</label><input type="text" id="update-video-url-720p" class="w-full bg-gray-700 rounded-md p-3 mt-1"></div>
                 <div><label for="update-video-url-480p" class="block text-sm font-medium">480p</label><input type="text" id="update-video-url-480p" class="w-full bg-gray-700 rounded-md p-3 mt-1"></div>
             </div>
             <div class="border-t border-gray-700 pt-6">
                <h3 class="text-lg font-semibold">Jadwal Publikasi</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                    <div><label for="update-publish-date" class="block text-sm font-medium">Tanggal</label><input type="date" id="update-publish-date" class="w-full bg-gray-700 rounded-md p-3 mt-1"></div>
                    <div><label for="update-publish-time" class="block text-sm font-medium">Waktu</label><input type="time" id="update-publish-time" class="w-full bg-gray-700 rounded-md p-3 mt-1"></div>
                </div>
             </div>
             <div class="flex justify-end space-x-4 pt-6"><button id="cancel-update-button" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-md">Batal</button><button id="save-update-button" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md">Simpan</button></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, Timestamp, query, orderBy, onSnapshot, doc, getDoc, updateDoc, deleteDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ============== LANGKAH PENTING! ==============
        // GANTI SEMUA ISI DI BAWAH INI DENGAN KONFIGURASI FIREBASE ANDA
        const firebaseConfig = {
            apiKey: "AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXX",
            authDomain: "nama-proyek-anda.firebaseapp.com",
            projectId: "nama-proyek-anda",
            storageBucket: "nama-proyek-anda.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:XXXXXXXXXXXXXXXXXXXXXX"
        };
        // ===============================================

        // Validasi Konfigurasi Firebase
        if (firebaseConfig.apiKey === "AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXX") {
            document.body.innerHTML = `
                <div class="bg-red-900 text-white p-8 rounded-lg shadow-2xl max-w-2xl mx-auto mt-20">
                    <h1 class="text-3xl font-bold mb-4">Konfigurasi Firebase Tidak Valid!</h1>
                    <p class="mb-4">Kunci API Firebase Anda belum diatur. Silakan buka file <strong>admin.html</strong>, cari bagian <strong>firebaseConfig</strong>, dan ganti dengan konfigurasi dari proyek Firebase Anda.</p>
                    <p>Halaman tidak akan berfungsi sampai Anda memperbarui konfigurasi ini.</p>
                </div>
            `;
            throw new Error("Invalid Firebase Configuration: Please replace the placeholder firebaseConfig object.");
        }

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const contentCollRef = collection(db, 'public/data/content');
        const settingsCollRef = collection(db, 'public/data/settings');

        const manageView = document.getElementById('manage-content-view');
        const addView = document.getElementById('add-content-view');
        const settingsView = document.getElementById('settings-view');
        const contentListContainer = document.getElementById('content-list-container');
        const statusMessage = document.getElementById('status-message');
        const uploadButton = document.getElementById('upload-button');
        const modal = document.getElementById('update-modal');

        async function main() {
            try {
                await signInAnonymously(auth);
                console.log("Signed in anonymously.");
                
                setupMenuNavigation();
                setupUploadListener();
                setupEventListeners();
                setupSettingsView();
                renderContentList();
            } catch (error) {
                console.error("Initialization or Auth failed:", error);
                // Pesan error sudah ditangani oleh validasi di atas,
                // tapi kita tambahkan log untuk debugging jika ada masalah lain.
            }
        }

        function setupMenuNavigation() {
            const menuButtons = { manage: document.getElementById('show-manage-view-btn'), add: document.getElementById('show-add-view-btn'), settings: document.getElementById('show-settings-view-btn') };
            const views = { manage: manageView, add: addView, settings: settingsView };
            function switchView(viewName) {
                Object.keys(views).forEach(key => {
                    views[key].classList.toggle('hidden', key !== viewName);
                    menuButtons[key].classList.toggle('active-menu', key === viewName);
                });
            }
            menuButtons.manage.addEventListener('click', () => switchView('manage'));
            menuButtons.add.addEventListener('click', () => switchView('add'));
            menuButtons.settings.addEventListener('click', () => switchView('settings'));
            switchView('manage');
        }

        function renderContentList() {
             const q = query(contentCollRef, orderBy("uploadedAt", "desc"));
             onSnapshot(q, (snapshot) => {
                 contentListContainer.innerHTML = '';
                 if (snapshot.empty) {
                     contentListContainer.innerHTML = '<p class="text-gray-400">Belum ada konten.</p>';
                     return;
                 }
                 snapshot.forEach(doc => {
                     const item = doc.data();
                     const publishDate = item.publishAt.toDate().toLocaleString('id-ID');
                     const itemEl = document.createElement('div');
                     itemEl.className = 'bg-gray-700 p-4 rounded-lg flex items-center justify-between';
                     itemEl.innerHTML = `
                        <div class="flex items-center space-x-4">
                            <img src="${item.thumbnailUrl}" alt="thumbnail" class="w-16 h-9 object-cover rounded-md bg-gray-600">
                            <div><h3 class="font-semibold text-white">${item.title}</h3><p class="text-sm text-gray-400">Tayang: ${publishDate}</p></div>
                        </div>
                        <div class="space-x-2">
                            <button data-id="${doc.id}" class="update-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md text-sm">Ubah</button>
                            <button data-id="${doc.id}" class="delete-btn bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md text-sm">Hapus</button>
                        </div>`;
                     contentListContainer.appendChild(itemEl);
                 });
             });
        }
        
        async function setupSettingsView() {
            const saveBtn = document.getElementById('save-settings-button');
            const status = document.getElementById('settings-status-message');
            const inputs = {
                background: document.getElementById('background-url'),
                mainLogo: document.getElementById('main-logo-url'),
                favicon: document.getElementById('favicon-url'),
                introVideo: document.getElementById('intro-video-url')
            };
            const previews = {
                background: document.getElementById('background-preview'),
                mainLogo: document.getElementById('main-logo-preview'),
                favicon: document.getElementById('favicon-preview'),
                introVideo: document.getElementById('intro-video-preview')
            };
             const previewContainers = {
                background: document.getElementById('background-preview-container'),
                mainLogo: document.getElementById('main-logo-preview-container'),
                favicon: document.getElementById('favicon-preview-container'),
                introVideo: document.getElementById('intro-video-preview-container')
            };
            for (const key in inputs) {
                const docRef = doc(settingsCollRef, key);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists() && docSnap.data().url) {
                    inputs[key].value = docSnap.data().url;
                    previews[key].src = docSnap.data().url;
                    previewContainers[key].classList.remove('hidden');
                }
            }
            saveBtn.addEventListener('click', async () => {
                status.textContent = "Menyimpan...";
                saveBtn.disabled = true;
                try {
                    for (const key in inputs) {
                        const url = inputs[key].value.trim();
                        const docRef = doc(settingsCollRef, key);
                        if (url) {
                            await setDoc(docRef, { url: url });
                            previews[key].src = url;
                            previewContainers[key].classList.remove('hidden');
                        } else {
                            await deleteDoc(docRef);
                            previews[key].src = '';
                            previewContainers[key].classList.add('hidden');
                        }
                    }
                    status.textContent = "Pengaturan berhasil disimpan!";
                } catch(e) {
                    status.textContent = "Gagal menyimpan pengaturan.";
                } finally {
                    saveBtn.disabled = false;
                    setTimeout(() => status.textContent = '', 3000);
                }
            });
        }

        function setupUploadListener() {
            uploadButton.addEventListener('click', async () => {
                const title = document.getElementById('title').value.trim();
                const thumbnailUrl = document.getElementById('thumbnail-url').value.trim();
                const videoUrl1080 = document.getElementById('video-url-1080p').value.trim();
                const videoUrl720 = document.getElementById('video-url-720p').value.trim();
                const videoUrl480 = document.getElementById('video-url-480p').value.trim();
                if (!title || !thumbnailUrl || (!videoUrl1080 && !videoUrl720 && !videoUrl480)) {
                    statusMessage.textContent = "Error: Judul, URL Thumbnail, dan minimal satu URL Video wajib diisi."; return;
                }
                statusMessage.textContent = "Menyimpan...";
                uploadButton.disabled = true;
                try {
                    const videoFiles = {};
                    if(videoUrl1080) videoFiles['1080p'] = videoUrl1080;
                    if(videoUrl720) videoFiles['720p'] = videoUrl720;
                    if(videoUrl480) videoFiles['480p'] = videoUrl480;
                    const dateStr = document.getElementById('publish-date').value;
                    const timeStr = document.getElementById('publish-time').value;
                    const publishAt = (dateStr && timeStr) ? Timestamp.fromDate(new Date(`${dateStr}T${timeStr}`)) : Timestamp.now();
                    await addDoc(contentCollRef, {
                        title, 
                        description: document.getElementById('description').value.trim(),
                        thumbnailUrl, 
                        videoFiles,
                        uploadedAt: Timestamp.now(), 
                        publishAt, 
                        viewCount: 0
                    });
                    statusMessage.textContent = "Konten berhasil diunggah!";
                    document.getElementById('title').value = '';
                    document.getElementById('thumbnail-url').value = '';
                    document.getElementById('video-url-1080p').value = '';
                    document.getElementById('video-url-720p').value = '';
                    document.getElementById('video-url-480p').value = '';
                    document.getElementById('description').value = '';
                    document.getElementById('publish-date').value = '';
                    document.getElementById('publish-time').value = '';
                } catch (error) {
                    statusMessage.textContent = "Error: Gagal menyimpan konten.";
                } finally {
                    uploadButton.disabled = false;
                    setTimeout(() => statusMessage.textContent = '', 3000);
                }
            });
        }

        async function openUpdateModal(id) {
            const docRef = doc(contentCollRef, id);
            const docSnap = await getDoc(docRef);
            if (!docSnap.exists()) { alert("Konten tidak ditemukan."); return; }
            const item = docSnap.data();
            document.getElementById('update-title').value = item.title;
            document.getElementById('update-thumbnail-url').value = item.thumbnailUrl;
            document.getElementById('update-description').value = item.description;
            document.getElementById('update-video-url-1080p').value = item.videoFiles['1080p'] || '';
            document.getElementById('update-video-url-720p').value = item.videoFiles['720p'] || '';
            document.getElementById('update-video-url-480p').value = item.videoFiles['480p'] || '';
            const publishDate = item.publishAt.toDate();
            document.getElementById('update-publish-date').value = publishDate.toISOString().split('T')[0];
            document.getElementById('update-publish-time').value = publishDate.toTimeString().split(' ')[0].substring(0, 5);
            document.getElementById('save-update-button').dataset.id = id;
            modal.classList.remove('hidden');
        }

        async function saveContentUpdate() {
            const saveButton = document.getElementById('save-update-button');
            const id = saveButton.dataset.id;
            if (!id) return;
            saveButton.disabled = true;
            try {
                const docRef = doc(contentCollRef, id);
                const videoFiles = {};
                const url1080 = document.getElementById('update-video-url-1080p').value.trim();
                const url720 = document.getElementById('update-video-url-720p').value.trim();
                const url480 = document.getElementById('update-video-url-480p').value.trim();
                if(url1080) videoFiles['1080p'] = url1080;
                if(url720) videoFiles['720p'] = url720;
                if(url480) videoFiles['480p'] = url480;

                const dateStr = document.getElementById('update-publish-date').value;
                const timeStr = document.getElementById('update-publish-time').value;
                const publishAt = (dateStr && timeStr) ? Timestamp.fromDate(new Date(`${dateStr}T${timeStr}`)) : Timestamp.now();
                
                await updateDoc(docRef, {
                    title: document.getElementById('update-title').value.trim(),
                    thumbnailUrl: document.getElementById('update-thumbnail-url').value.trim(),
                    description: document.getElementById('update-description').value.trim(),
                    videoFiles,
                    publishAt
                });
                modal.classList.add('hidden');
            } catch (error) {
                alert("Gagal menyimpan perubahan.");
            } finally {
                saveButton.disabled = false;
            }
        }

        function setupEventListeners() {
            contentListContainer.addEventListener('click', async (e) => {
                const id = e.target.dataset.id;
                if (!id) return;
                if (e.target.classList.contains('update-btn')) {
                    openUpdateModal(id);
                }
                if (e.target.classList.contains('delete-btn')) {
                    if (confirm("Yakin ingin menghapus konten ini?")) {
                        await deleteDoc(doc(contentCollRef, id));
                    }
                }
            });
            document.getElementById('cancel-update-button').addEventListener('click', () => modal.classList.add('hidden'));
            document.getElementById('save-update-button').addEventListener('click', saveContentUpdate);
        }

        main();
    </script>
</body>
</html>

